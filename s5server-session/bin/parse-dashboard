#!/usr/bin/env node

var express = require('express');
var ParseDashboard = require('parse-dashboard');
var argv = require('optimist').argv;
var utils = require('../lib/utils');

var config = {}, options = {};

if (argv.config) {
  try {
    var data = fs.readFileSync(argv.config);
    config = JSON.parse(data.toString());
  } catch (ex) {
    console.error('Error starting session server: ' + ex);
    process.exit(1);
  }
}
options['host'] = argv.host || utils.getIP();
options['port'] = 8080;
if (config.port) options['port'] = config.port;
if (argv.port) options['port'] = argv.port;

if (config.app) options['app'] = config.app;
if (config.master) options['master'] = config.master;

var dashboard = new ParseDashboard({
  "apps": [
    {
      "serverURL": options.host+':'+options.port+'/parse',
      "appId": options.app || 'STALK',
      "masterKey": options.master || 's3cR3T'
    }
  ]
});

var app = express();
app.use('/dashboard', dashboard);

var httpServer = require('http').createServer(app);
httpServer.listen(4040);
